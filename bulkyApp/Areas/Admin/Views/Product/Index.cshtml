@model List<Bulky.Models.Product>

<div class="container-fluid mt-5 px-5">
    <div class="card shadow rounded-4 border-0">
        <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center mb-4 px-3">
                <h2 class="fw-bold text-primary mb-0">📦 Product List</h2>
                <a class="btn btn-outline-primary rounded-pill px-4" asp-controller="Product" asp-action="Upsert">
                    <i class="bi bi-plus-circle me-2"></i> Add Product
                </a>
            </div>

            <div class="table-responsive" style="overflow-x: auto; max-height: 750px; overflow-y: auto;">
                <table id="tblData" class="table align-middle text-center table-striped table-hover mb-0" style="width:100%;">
                    <thead class="table-primary text-secondary">
                        <tr>
                            <th style="min-width: 150px;">Title</th>
                            <th style="min-width: 350px;">Description</th>
                            <th style="min-width: 120px;">ISBN</th>
                            <th style="min-width: 150px;">Author</th>
                            <th style="min-width: 100px;">Price</th>
                            <th style="min-width: 120px;">Category</th>
                            <th style="min-width: 120px;">Actions</th>
                        </tr>
                    </thead>
                </table>
                @if (!Model.Any())
                {
                    <p class="text-center text-muted mt-3">No products available.</p>
                }
            </div>
        </div>
    </div>
</div>

<!-- أضف هذا السطر داخل <head> أو قبل السكربتات أسفل الصفحة -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    $(document).ready(function () {
        var dataTable = $('#tblData').DataTable({
            responsive: true,
            "ajax": {
                "url": "/Admin/Product/GetAll",
                "dataSrc": "data"
            },
            "columns": [
                { data: 'title', width: "150px" },
                { data: 'description', width: "350px" },
                { data: 'isbn', width: "120px" },
                { data: 'author', width: "150px" },
                { data: 'listPrice', width: "100px" },
                { data: 'category.name', width: "120px" },
                {
                    data: 'id',
                    width: "160px",
                    render: function (data) {
                        return `
                            <a href="/Admin/Product/Upsert?id=${data}"
                               class="btn btn-outline-success btn-sm rounded-pill me-2 px-3"
                               title="Edit Product">
                               <i class="bi bi-pencil-square me-1"></i> Edit
                            </a>
                            <a href="javascript:void(0);"
                               onclick="deleteProduct('/Admin/Product/Delete/${data}')"
                               class="btn btn-outline-danger btn-sm rounded-pill px-3"
                               title="Delete Product">
                               <i class="bi bi-trash me-1"></i> Delete
                            </a>
                        `;
                    }
                }
            ]
        });

        window.deleteProduct = function (url) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: url,
                        type: 'DELETE',
                        success: function (response) {
                            if (response.success) {
                                Swal.fire(
                                    'Deleted!',
                                    response.message,
                                    'success'
                                );
                                dataTable.ajax.reload(null, false); // تحديث الجدول بدون إعادة تعيين الصفحة
                            } else {
                                Swal.fire(
                                    'Error!',
                                    response.message,
                                    'error'
                                );
                            }
                        },
                        error: function () {
                            Swal.fire(
                                'Error!',
                                'An error occurred while deleting the product.',
                                'error'
                            );
                        }
                    });
                }
            });
        };
    });
</script>
