@model List<Bulky.Models.Company>

<div class="container-fluid mt-5 px-5">
    <div class="card shadow rounded-4 border-0">
        <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center mb-4 px-3">
                <h2 class="fw-bold text-primary mb-0">🏢 Company List</h2>
                <a class="btn btn-outline-primary rounded-pill px-4" asp-controller="Company" asp-action="Upsert">
                    <i class="bi bi-plus-circle me-2"></i> Add Company
                </a>
            </div>

            <div class="table-responsive" style="overflow-x: auto; max-height: 750px; overflow-y: auto;">
                <table id="tblData" class="table align-middle text-center table-striped table-hover mb-0" style="width:100%;">
                    <thead class="table-primary text-secondary">
                        <tr>
                            <th style="min-width: 150px;">Name</th>
                            <th style="min-width: 200px;">Street Address</th>
                            <th style="min-width: 120px;">City</th>
                            <th style="min-width: 120px;">State</th>
                            <th style="min-width: 120px;">Postal Code</th>
                            <th style="min-width: 150px;">Phone Number</th>
                            <th style="min-width: 120px;">Actions</th>
                        </tr>
                    </thead>
                </table>

                @if (Model == null || !Model.Any())
                {
                    <p class="text-center text-muted mt-3">No companies available.</p>
                }
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    $(document).ready(function () {
        var dataTable = $('#tblData').DataTable({
            responsive: true,
            "ajax": {
                "url": "/Admin/Company/GetAll",
                "dataSrc": "data"
            },
            "columns": [
                { data: 'name', width: "150px" },
                { data: 'streetAddress', width: "200px" },
                { data: 'city', width: "120px" },
                { data: 'state', width: "120px" },
                { data: 'postalCode', width: "120px" },
                { data: 'phoneNumber', width: "150px" },
                {
                    data: 'id',
                    width: "160px",
                    render: function (data) {
                        return `
                            <a href="/Admin/Company/Upsert?id=${data}"
                               class="btn btn-outline-success btn-sm rounded-pill me-2 px-3"
                               title="Edit Company">
                               <i class="bi bi-pencil-square me-1"></i> Edit
                            </a>
                            <a href="javascript:void(0);"
                               onclick="deleteCompany('/Admin/Company/Delete/${data}')"
                               class="btn btn-outline-danger btn-sm rounded-pill px-3"
                               title="Delete Company">
                               <i class="bi bi-trash me-1"></i> Delete
                            </a>
                        `;
                    }
                }
            ]
        });

        window.deleteCompany = function (url) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: url,
                        type: 'DELETE',
                        success: function (response) {
                            if (response.success) {
                                Swal.fire('Deleted!', response.message, 'success');
                                dataTable.ajax.reload(null, false);
                            } else {
                                Swal.fire('Error!', response.message, 'error');
                            }
                        },
                        error: function () {
                            Swal.fire('Error!', 'An error occurred while deleting the company.', 'error');
                        }
                    });
                }
            });
        };
    });
</script>
